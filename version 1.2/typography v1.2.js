function removeProtocol(e){return e.replace(/^https?\:\/\//i,"")}let domain=removeProtocol(window.location.origin);function startBlyad(e){var a,t,r,n,o;if(params=JSON.parse($("#typography").attr("data-params")),function e(){c=.001*d;l=.001*m;t&&(t.rotation.y+=parseFloat(params.camSens)*(c-t.rotation.y),t.rotation.x+=parseFloat(params.camSens)*(l-t.rotation.x));requestAnimationFrame(e);t&&(o.map.offset.x-=parseFloat(params.textMoveX),o.map.offset.y+=parseFloat(params.textMoveY),o.map.needsUpdate=!0,n.rotation.x+=parseFloat(params.objRotX),n.rotation.y-=parseFloat(params.objRotY),n.rotation.z+=parseFloat(params.objRotZ),r.render(t,a))}(),(a=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,3e3)).position.z=125,(t=new THREE.Scene).background=new THREE.Color(parseInt(params.bgColor,16)),null!=e){alert("Используется бесплатная версия. Посетите dev-donut.ru");const e=(new THREE.TextureLoader).load("https://static.tildacdn.com/tild3835-3731-4465-b036-373561386232/free-overlay.png"),r=new THREE.SpriteMaterial({map:e}),n=new THREE.Sprite(r);n.scale.set(window.innerWidth/4,window.innerHeight/4,1),t.add(n);var i=new THREE.Vector3(0,0,-10);i.applyQuaternion(a.quaternion),n.position.copy(i)}switch(o=new THREE.MeshBasicMaterial,params.objType){case"cube":n=new THREE.Mesh(new THREE.BoxGeometry(parseInt(params.param1),parseInt(params.param2),parseInt(params.param3)),o);break;case"sphere":n=new THREE.Mesh(new THREE.SphereGeometry(parseInt(params.param1),32,32),o);break;case"cylinder":n=new THREE.Mesh(new THREE.CylinderGeometry(parseInt(params.param1),parseInt(params.param2),parseInt(params.param3),90),o);break;case"torus":n=new THREE.Mesh(new THREE.TorusBufferGeometry(parseInt(params.param1),parseInt(params.param2),50,50),o)}t.add(n);const s=document.querySelector("#typography");function p(e){var a=document.createElement("canvas");a.width=params.textureSize,a.height=params.textureSize;var t=a.getContext("2d");t.strokeStyle=params.textColor,t.fillStyle=params.objColor,t.fillRect(0,0,a.width,a.height),t.lineWidth=params.strokeWidth,t.font=params.fontSize+"px "+params.font+", Arial";for(var r=0;r<6;r++)t.strokeText(e,0,200*r);o.map=new THREE.CanvasTexture(a,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping),document.getElementById("typography").appendChild(a)}r=new THREE.WebGLRenderer({canvas:s}),window.addEventListener("resize",h,!1),p(params.text),h();var d=0,m=0,c=0,l=0,w=window.innerWidth/2,E=window.innerHeight/2;function h(){a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix(),r.setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth,window.innerHeight)}document.addEventListener("mousemove",function(e){d=e.clientX-w,m=e.clientY-E},!1)}$.post("https://donut-server.ru:8443/lib-domain",{domain:domain}).success(function(e){$.getScript("https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js",function(){startBlyad()})}).error(function(e){$.getScript("https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js",function(){["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?startBlyad():startBlyad("free")}),window.open("https://dev-donut.ru/error")});
