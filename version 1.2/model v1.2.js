function removeProtocol(t){return t.replace(/^https?\:\/\//i,"")}let domain=removeProtocol(window.location.origin);function startBlyad(t){params=JSON.parse($("#model").attr("data-params"));const e=document.querySelector("#model"),a=new THREE.WebGLRenderer({canvas:e});a.setPixelRatio(window.devicePixelRatio),a.setSize(window.innerWidth,window.innerHeight);const o=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4);o.position.z=params.camPosZ;const r=new THREE.Scene;if(r.background=new THREE.Color(parseInt(params.bgColor,16)),null!=t){alert("Используется бесплатная версия. Посетите dev-donut.ru");const t=(new THREE.TextureLoader).load("https://static.tildacdn.com/tild3835-3731-4465-b036-373561386232/free-overlay.png"),e=new THREE.SpriteMaterial({map:t}),a=new THREE.Sprite(e);a.scale.set(window.innerWidth/40,window.innerHeight/40,1),r.add(a);var n=new THREE.Vector3(0,0,-10);n.applyQuaternion(o.quaternion),a.position.copy(n)}let s,i,p,l;hemisphereLight=new THREE.HemisphereLight(parseInt(params.hemiColor1,16),parseInt(params.hemiColor2,16),params.hemiIntensity),(s=new THREE.PointLight(parseInt(params.light1Color,16),params.light1Intensity)).position.set(parseInt(params.light1PosX),parseInt(params.light1PosY),parseInt(params.light1PosZ)),(i=new THREE.PointLight(parseInt(params.light2Color,16),params.light2Intensity)).position.set(parseInt(params.light2PosX),parseInt(params.light2PosY),parseInt(params.light2PosZ)),(p=new THREE.PointLight(parseInt(params.light3Color,16),params.light3Intensity)).position.set(parseInt(params.light3PosX),parseInt(params.light3PosY),parseInt(params.light3PosZ)),r.add(hemisphereLight),r.add(s),r.add(i),r.add(p);const d=new THREE.GLTFLoader;d.load(params.modelLink,function(t){(l=t.scene).scale.set(parseInt(params.scale),parseInt(params.scale),parseInt(params.scale)),r.add(t.scene)},void 0,function(t){console.error(t)}),a.render(r,o);const m=new THREE.OrbitControls(o,e);function c(){E=window.innerWidth/2,R=window.innerHeight/2,o.aspect=window.innerWidth/window.innerHeight,o.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight),f()}m.update(),f(),window.addEventListener("resize",c,!1),c();var h=0,w=0,u=0,g=0,E=window.innerWidth/2,R=window.innerHeight/2;document.addEventListener("mousemove",function(t){h=t.clientX-E,w=t.clientY-R},!1);let P=0;function f(){requestAnimationFrame(f),m.enabled="true"===params.orbit,m.update(),params.camPosX=o.position.x.toFixed(3).toString(),params.camPosY=o.position.y.toFixed(3).toString(),params.camPosZ=o.position.z.toFixed(3).toString(),null!=l&&(l.rotation.x+=parseFloat(params.autoRotateX),l.rotation.y+=parseFloat(params.autoRotateY),l.rotation.z+=parseFloat(params.autoRotateZ),u=.001*h,g=.001*w,"true"===params.mouseControls&&(r.rotation.y+=parseFloat(params.camSens)*(u-r.rotation.y),r.rotation.x+=parseFloat(params.camSens)*(g-r.rotation.x))),a.render(r,o)}$(window).scroll(function(){if(null!=l){var t=$(this).scrollTop();t>P?(l.rotation.x+=parseFloat(params.scrollRotateX),l.rotation.y+=parseFloat(params.scrollRotateY),l.rotation.z+=parseFloat(params.scrollRotateZ)):(l.rotation.x-=parseFloat(params.scrollRotateX),l.rotation.y-=parseFloat(params.scrollRotateY),l.rotation.z-=parseFloat(params.scrollRotateZ)),P=t}})}$.post("https://donut-server.ru:8443/lib-domain",{domain:domain}).success(function(t){$.getScript("https://cdnjs.cloudflare.com/ajax/libs/three.js/92/three.min.js",function(){$.getScript("https://unpkg.com/three@0.85.0/examples/js/controls/OrbitControls.js",function(){$.getScript("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r92/examples/js/loaders/GLTFLoader.js",function(){startBlyad()})})})}).error(function(t){$.getScript("https://cdnjs.cloudflare.com/ajax/libs/three.js/92/three.min.js",function(){$.getScript("https://unpkg.com/three@0.85.0/examples/js/controls/OrbitControls.js",function(){$.getScript("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r92/examples/js/loaders/GLTFLoader.js",function(){["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?startBlyad():startBlyad("free")})})}),window.open("https://dev-donut.ru/error")});
